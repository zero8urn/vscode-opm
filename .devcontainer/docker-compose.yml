services:
  opm-container:
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
    user: root  
    volumes:
      - ..:/workspace:cached
      - node_modules:/workspace/node_modules
      - root:/root
      - ${HOME}/.ssh:/root/.ssh:ro
      - ${HOME}/.gitconfig:/root/.gitconfig  # Use ${HOME} on Linux; remove :ro if container must write
      - ${HOME}/.local/share/opencode:/root/.local/share/opencode
      - ./nuget-configs:/root/.nuget/NuGet:ro
    depends_on:
      - nginx-proxy
    # Use the same user as the base image (devcontainer tooling will handle UID mapping)
    tty: true
    command: sleep infinity
  nginx-proxy:
    build:
      context: ./nginx
      dockerfile: Dockerfile
      args:
        HT_USER: testuser
        HT_PASS: testpass
    image: opm-nginx-basic:latest
    ports:
      - "8080:80"
    tty: true
volumes:
  node_modules:
  root:
